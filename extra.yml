# Dwm
- name: "Linking DWM repo"
  file:
    src: "/home/albert/dotfiles/dwm"
    dest: "/home/albert/.dwm"
    state: link
  notify: compile-dwm

# Timezone
- name: "Setting timezone"
  timezone:
    hwclock: "local"
    name: "Europe/Madrid"
  become: true

# Grub
- name: "Grub screen resolution"
  replace:
    path: "/etc/default/grub"
    regexp: '^GRUB_GFXMODE\=.*$'
    replace: 'GRUB_GFXMODE=1920x1080,auto'
  notify: "update-grub"
  become: true

# Ly
- name: "Configure ly service"
  service:
    name: ly
    enabled: true
  become: true

- name: "Download Dracula theme for GTK"
  unarchive:
    src: "https://github.com/dracula/gtk/archive/master.zip"
    dest: "/tmp/"
    remote_src: true
    creates: "/home/albert/.themes/Dracula/README.md"
  notify: copy-gtk-theme-temp

- name: "Apply GTK Dracula Theme 1"
  dconf:
    key: "/org/gnome/desktop/interface"
    value: "['gtk-theme', 'Dracula']"

- name: "Apply GTK Dracula Theme 2"
  dconf:
    key: "/org/gnome/desktop/wm/preferences"
    value: "['theme', 'Dracula']"

# Systemd

- name: "Add rc-local service"
  copy:
    src: "systemd/rc-local.service"
    dest: "/etc/systemd/system/rc-local.service"
  become: true

- name: "Configure rc-local service"
  service:
    name: "rc-local.service"
    enabled: true
  become: true

- name: "Copy rc.local file"
  copy:
    src: "systemd/rc.local"
    dest: "/etc/rc.local"
    mode: "o+x"
  become: true

# Wallpapers

- name: "Create wallpapers directory"
  file:
    path: "/home/albert/wallpapers"
    state: directory


- name: "Download wallpapers"
  unarchive:
    src: "https://www.albertcanales.com/wallpapers.zip"
    dest: "/home/albert/wallpapers/"
    remote_src: true
    creates: "/home/albert/wallpapers/README.md"


# Sudoers

- name: Allow albert to run reboot and poweroff without password
  community.general.sudoers:
    name: albert-power-commands
    user: albert
    commands:
      - /bin/systemctl poweroff
      - /bin/systemctl reboot
    nopassword: true
  become: true


# Nvim

- name: Install nvim plugins
  command: "/home/albert/dotfiles/nvim/plugins.sh"
  register: nvim_plugins
  changed_when: "nvim_plugins.rc == 1"
  failed_when: "nvim_plugins.rc not in [0, 1]"